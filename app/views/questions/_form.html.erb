<%= form_for(@question) do |f| %>
  <% if @question.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@question.errors.count, "error") %> prohibited this question from being saved:</h2>

      <ul>
      <% @question.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :content %><br>
    <%= f.text_area :content %>
  </div>
  <div class="field">
    <%= f.label :difficulty %><br>
    <%= f.select :difficulty, options_for_select(["kerge", "keskmine", "raske"]) %>
  </div>
  <div class="field">
    <%= f.label :status %><br>
    <%= f.select :status, options_for_select(["Kinnitamata", "Kinnitatud", "Lukustatud"]) %>
  </div>
<fieldset id="labels">
  <legend>Labels</legend>
  <%= f.fields_for :labels do |labels_form| %>
    <%= labels_form.text_field :name , :class=>"q_label" %>
  <% end %>  
</fieldset>
<fieldset id="answers">
  <legend>Answers</legend>
   <button id="addInput"  type="button">Add answer</button><br/>
   <%= f.fields_for :answers do |answers_form| %>
   <p> <span class="destroy_this"><%= answers_form.check_box :_destroy%></span></br>
      <%= answers_form.text_area :content, placeholder: "Answer text" %> <br/>
      <%= answers_form.number_field :points, size:4 , placeholder: "points" %>
      <%= answers_form.label :correct %>
      <%= answers_form.check_box :correct %>
   </p>
   <% end # answer form %>
</fieldset>


  <div class="actions">
    <%= f.submit %>
  </div>
<% end #question form %>
<script>
$(document).ready(function() { 

answers=$("#answers");
labels=$("#labels");
  $('#addInput').click(function(){  
    n = answers.children("p").length;

    var par=document.createElement("p");
    
    var text=document.createElement("textarea");
    text.name="question[answers_attributes]["+n+"][content]";
    text.placeholder="Answer text";
    par.appendChild(text);

    var br=document.createElement("br");
    par.appendChild(br);
    
    var points=document.createElement("input");
    points.type="number";
    points.size=4;
    points.placeholder="Points";
    points.name="question[answers_attributes]["+n+"][points]";
    par.appendChild(points);
    
    var label=document.createElement("label");
    label.for="question_answers_attributes_"+n+"_correct";
    label.innerHTML="Correct";
    par.appendChild(document.createTextNode(' '));
    par.appendChild(label);
    par.appendChild(document.createTextNode(' '));
    
    var correct=document.createElement("input");
    correct.type="checkbox";
    correct.name="question[answers_attributes]["+n+"][correct]";
    correct.id='question_answers_attributes_'+n+'_correct';
    par.appendChild(correct);

    inputs='<p><textarea name="question[answers_attributes]['+n+'][content]" placeholder="Answer text"></textarea> <br/><input name="question[answers_attributes]['+n+'][points]" placeholder="points" size="4" type="number" /> <label for="question_answers_attributes_'+n+'_correct">Correct</label> <input name="question[answers_attributes]['+n+'][correct]" type="hidden" value="0" /><input id="question_answers_attributes_'+n+'_correct" name="question[answers_attributes]['+n+'][correct]" type="checkbox" value="1" /></p>';
    answers.append(par);
  });

  $('#labels input').blur(function(){
    console.log(labels.children('input').length);
    addLabels();
  });

});

function addLabels(){
  if ($("#labels input:last-child").val() != "" ){
    m=labels.children('input[type=text]').length;
    var input=document.createElement('input');
    input.type="text";
    input.name='question[labels_attributes]['+m+'][name]';
    input.class="q_label";
    input.onblur=addLabels;
    $("#labels").append(input);    
    $("#labels").append(document.createTextNode(' '));
    $("#labels input:last-child").focus();
  }

}

</script>